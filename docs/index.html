<!doctype html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>â­ My Library â­</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />
  <link rel="stylesheet" href="css/style.css?v=2.0.0" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="js/bridge.js"></script>
  <script src="js/api_client.js"></script>
  <script src="js/main.js"></script>
  <link rel="icon" href="data:,">
</head>
<body>
  <button class="sidebar-toggle" onclick="toggleSidebar()" title="Menu">
    <span class="toggle-icon">â˜°</span>
  </button>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <span class="sidebar-title">Menu</span>
      <button class="sidebar-close" onclick="toggleSidebar()">Ã—</button>
    </div>

    <div class="sidebar-content">
      <div class="sidebar-item theme-toggle" onclick="toggleTheme()">
        <span class="item-text">Dark / Light</span>
        <span class="theme-indicator" id="themeIndicator">ğŸŒ™</span>
      </div>

      <div class="sidebar-divider"></div>

      <div class="sidebar-section">
        <div class="sidebar-item active" data-tab="all" onclick="switchTab('all')">
          <span class="item-text">All</span>
        </div>
        <div class="sidebar-item" data-tab="Novel" onclick="switchTab('Novel')">
          <span class="item-text">Novel</span>
        </div>
        <div class="sidebar-item" data-tab="Webtoon" onclick="switchTab('Webtoon')">
          <span class="item-text">Webtoon</span>
        </div>
        <div class="sidebar-item" data-tab="Manga" onclick="switchTab('Manga')">
          <span class="item-text">Comic</span>
        </div>
      </div>

      <div class="sidebar-divider"></div>

      <div class="sidebar-section">
        <div class="sidebar-item toggle-item" onclick="toggleAdultFilter()">
          <span class="item-text">Adult</span>
          <span class="toggle-switch" id="adultToggle"></span>
        </div>
        <div class="sidebar-item" onclick="showFavorites()">
          <span class="item-text">Favorites</span>
        </div>
        <div class="sidebar-item" onclick="showCalendar()">
          <span class="item-text">Calendar</span>
        </div>
        <div class="sidebar-item" onclick="showTags()">
          <span class="item-text">Tags</span>
        </div>
      </div>

      <div class="sidebar-divider"></div>

      <div class="sidebar-section">
        <div class="sidebar-item accordion-header" onclick="toggleSettingsAccordion()">
          <span class="item-text">Settings</span>
          <span class="accordion-icon" id="settingsIcon">â–¼</span>
        </div>
        
        <div class="accordion-content" id="settingsContent">
          <div class="settings-group">
            <div class="settings-item" onclick="showBackupRestore()">
              <span>ë°±ì—…/ë³µì›</span>
            </div>
          </div>

          <div class="settings-group">
            <div class="settings-label">ë°”ë¡œê°€ê¸° ë„ë©”ì¸</div>
            <div class="input-row">
              <label>ë§ˆë‚˜í† ë¼</label>
              <input type="text" id="url_manatoki" class="config-input" placeholder="469" />
            </div>
            <div class="input-row">
              <label>ë‰´í† ë¼</label>
              <input type="text" id="url_newtoki" class="config-input" placeholder="469" />
            </div>
            <div class="input-row">
              <label>ë¶í† ë¼</label>
              <input type="text" id="url_booktoki" class="config-input" placeholder="469" />
            </div>
          </div>

          <div class="settings-group">
            <div class="settings-label">ì„œë²„ ì—°ê²°</div>
            <div class="input-row">
              <label>Folder ID</label>
              <input type="text" id="setting_folderId" class="config-input" placeholder="Google Drive Folder ID" />
            </div>
            <div class="input-row">
              <label>GAS ID</label>
              <input type="text" id="setting_deployId" class="config-input" placeholder="AKfycb..." />
            </div>
            <div class="input-row">
              <label>API Key</label>
              <input type="password" id="setting_apiKey" class="config-input" placeholder="API Key" />
            </div>
          </div>

          <div class="settings-group">
            <div class="settings-label">ë·°ì–´ ì„¤ì •</div>
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" id="pref_2page" />
                <span>2ìª½ ë³´ê¸°</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="pref_cover" />
                <span>í‘œì§€ ìš°ì„ </span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="pref_rtl" />
                <span>ì¼ë³¸ë§Œí™”(ìš°ì¢Œ)</span>
              </label>
            </div>
            <div style="display:none;">
              <input type="radio" name="view_engine" value="foliate" />
              <input type="radio" name="view_engine" value="legacy" checked />
            </div>
          </div>

          <button class="btn btn-save-settings" onclick="saveActiveSettings()">ì €ì¥</button>
        </div>
      </div>
    </div>
    
    <div class="sidebar-version" id="viewerVersionDisplay">
      Version: Loading...
    </div>
  </div>

  <div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

  <div class="app-container">
    <header>
      <div class="header-top">
        <h1 onclick="location.reload()">My Library</h1>
      </div>
      <div class="header-controls">
        <div class="search-wrapper">
          <input type="text" id="search" class="search-box" placeholder="Search..." onkeyup="filterData()" />
        </div>
        <button class="btn-theme-header" onclick="toggleTheme()" title="Theme">
          <span class="theme-icon" id="headerThemeIcon">ğŸŒ™</span>
        </button>
      </div>
    </header>

    <main class="main-content">
      <div class="grid-container" id="grid"></div>
      
      <div class="calendar-page" id="calendarPage" style="display: none;">
        <div class="calendar-container">
          <div class="calendar-stats">
            <div class="stat-item">
              <span class="stat-value" id="statCompleted">0</span>
              <span class="stat-label">Completed</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="statDropped">0</span>
              <span class="stat-label">Dropped</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="statReading">0</span>
              <span class="stat-label">Reading</span>
            </div>
          </div>
          
          <div class="calendar-wrapper">
            <div class="calendar-header">
              <button class="cal-nav" onclick="prevMonth()">â—€</button>
              <span class="cal-title" id="calendarTitle">2025ë…„ 1ì›”</span>
              <button class="cal-nav" onclick="nextMonth()">â–¶</button>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
          </div>
          
          <div class="calendar-records" id="calendarRecords">
            <div class="records-header">
              <span class="records-date" id="selectedDate">ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</span>
            </div>
            <div class="records-list" id="recordsList"></div>
            <button class="btn btn-add-record" id="btnAddRecord" style="display:none;" onclick="showAddRecordModal()">+ ì‘í’ˆ ì¶”ê°€</button>
          </div>
        </div>
      </div>
    </main>
  </div>
    <div id="detailModal" class="modal-overlay">
    <div class="modal detail-modal">
      <div class="modal-header">
        <div class="modal-title" id="detailTitle">ì‘í’ˆ ì œëª©</div>
        <button class="modal-close" onclick="closeDetailModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="detail-cover-wrapper" onclick="toggleDetailEpisodes()">
          <img id="detailCover" class="detail-cover" src="" alt="Cover">
          <div class="detail-cover-no-image" id="detailCoverNoImage">No Image</div>
          <div class="cover-hint">í´ë¦­í•˜ì—¬ ëª©ë¡ ë³´ê¸°</div>
        </div>
        
        <div class="detail-episodes" id="detailEpisodes" style="display:none;">
          <div class="episode-drive-link">
            <a href="#" id="detailDriveLink" target="_blank">ğŸ“‚ ë“œë¼ì´ë¸Œì—ì„œ ë³´ê¸°</a>
          </div>
          <div class="episode-list-wrapper" id="detailEpisodeList"></div>
        </div>
        
        <div class="detail-info">
          <div class="info-row">
            <span class="info-label">ì œëª©</span>
            <span class="info-value" id="detailInfoTitle">-</span>
          </div>
          <div class="info-row">
            <span class="info-label">ì‘ê°€</span>
            <span class="info-value" id="detailInfoAuthor">-</span>
          </div>
          <div class="info-row">
            <span class="info-label">ìƒíƒœ</span>
            <span class="info-value" id="detailInfoStatus">-</span>
          </div>
          <div class="info-row clickable" onclick="openPlatformSite()">
            <span class="info-label">í”Œë«í¼</span>
            <span class="info-value info-link" id="detailInfoPlatform">-</span>
          </div>
          <div class="info-row">
            <span class="info-label">ì¹´í…Œê³ ë¦¬</span>
            <span class="info-value" id="detailInfoCategory">-</span>
          </div>
          <div class="info-row">
            <span class="info-label">íšŒì°¨</span>
            <span class="info-value" id="detailInfoCount">-</span>
          </div>
        </div>
        
        <div class="detail-actions">
          <button class="btn btn-edit-detail" onclick="openEditFromDetail()">Edit</button>
        </div>
      </div>
    </div>
  </div>

  <div id="tagsModal" class="modal-overlay">
    <div class="modal tags-modal">
      <div class="modal-header">
        <div class="modal-title">Tags</div>
        <button class="modal-close" onclick="closeTagsModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="tags-create">
          <input type="text" id="newTagInput" class="config-input" placeholder="ìƒˆ íƒœê·¸ ì…ë ¥...">
          <button class="btn btn-add-tag" onclick="createTag()">ì¶”ê°€</button>
        </div>
        <div class="tags-list" id="tagsList"></div>
      </div>
    </div>
  </div>

  <div id="configModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">ì„œë²„ ì—°ê²° ì„¤ì •</div>
      </div>
      <div class="modal-body" style="text-align: center">
        <p class="modal-desc">Google Apps Script ë°°í¬ URLê³¼ í´ë” IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
        <div class="config-group">
          <label class="config-label">GAS ì›¹ ì•± URL</label>
          <input type="text" id="configApiUrl" class="config-input" placeholder="https://script.google.com/macros/s/.../exec" />
        </div>
        <div class="config-group">
          <label class="config-label">ë£¨íŠ¸ í´ë” ID</label>
          <input type="text" id="configFolderId" class="config-input" placeholder="Google Drive Folder ID" />
        </div>
        <div class="config-group">
          <label class="config-label">API Key (ë³´ì•ˆ)</label>
          <input type="password" id="configApiKey" class="config-input" placeholder="API Key (ì„ íƒì‚¬í•­)" />
        </div>
        <button class="btn btn-save" onclick="saveManualConfig()">ì„¤ì • ì €ì¥</button>
      </div>
    </div>
  </div>

  <div id="editModal" class="modal-overlay">
    <div class="modal edit-modal">
      <div class="modal-header">
        <div class="modal-title">ì‘í’ˆ ì •ë³´ í¸ì§‘</div>
        <button class="modal-close" onclick="closeEditModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="edit-cover-section">
          <div class="edit-cover-preview">
            <img id="editCoverPreview" src="" alt="ì»¤ë²„">
            <div class="edit-cover-no-image" id="editCoverNoImage">No Image</div>
          </div>
          <div class="edit-cover-actions">
            <label class="btn btn-upload" for="editCoverFile">ì»¤ë²„ ì—…ë¡œë“œ</label>
            <input type="file" id="editCoverFile" accept="image/*" style="display:none" onchange="handleCoverSelect(event)">
            <div class="edit-cover-filename" id="editCoverFilename"></div>
          </div>
        </div>

        <div class="edit-form">
          <div class="edit-field">
            <label>ì œëª©</label>
            <input type="text" id="editTitle" placeholder="ì‘í’ˆ ì œëª©">
          </div>
          <div class="edit-field">
            <label>ì‘ê°€</label>
            <input type="text" id="editAuthor" placeholder="ì‘ê°€ëª…">
          </div>
          <div class="edit-field">
            <label>ì—°ì¬ìƒíƒœ</label>
            <select id="editStatus">
              <option value="Unknown">ì•Œìˆ˜ì—†ìŒ</option>
              <option value="ì—°ì¬ì¤‘">ì—°ì¬ì¤‘</option>
              <option value="ì™„ê²°">ì™„ê²°</option>
              <option value="íœ´ì¬">íœ´ì¬</option>
            </select>
          </div>
          <div class="edit-field">
            <label>í”Œë«í¼</label>
            <select id="editPublisher">
              <option value="">ë¯¸ì§€ì •</option>
              <option value="ë„¤ì´ë²„">ë„¤ì´ë²„</option>
              <option value="ì¹´ì¹´ì˜¤">ì¹´ì¹´ì˜¤</option>
              <option value="ë¬¸í”¼ì•„">ë¬¸í”¼ì•„</option>
              <option value="ì¡°ì•„ë¼">ì¡°ì•„ë¼</option>
              <option value="ë¦¬ë””">ë¦¬ë””</option>
              <option value="ë…¸ë²¨í”¼ì•„">ë…¸ë²¨í”¼ì•„</option>
              <option value="ë ˆì§„ì½”ë¯¹ìŠ¤">ë ˆì§„ì½”ë¯¹ìŠ¤</option>
              <option value="íƒ‘íˆ°">íƒ‘íˆ°</option>
              <option value="ë´„íˆ°">ë´„íˆ°</option>
              <option value="ì¼ë³¸ë§Œí™”">ì¼ë³¸ë§Œí™”</option>
              <option value="ê¸°íƒ€í”Œë«í¼">ê¸°íƒ€í”Œë«í¼</option>
            </select>
          </div>
          <div class="edit-field">
            <label>ì¹´í…Œê³ ë¦¬</label>
            <select id="editCategory">
              <option value="Manga">ë§Œí™” (Manga)</option>
              <option value="Webtoon">ì›¹íˆ° (Webtoon)</option>
              <option value="Novel">ì†Œì„¤ (Novel)</option>
            </select>
          </div>
        </div>

        <input type="hidden" id="editSourceId">
        <input type="hidden" id="editUrl">

        <div class="edit-buttons">
          <button class="btn edit-btn-cancel" onclick="closeEditModal()">ì·¨ì†Œ</button>
          <button class="btn edit-btn-save" onclick="saveEditInfo()">ì €ì¥</button>
        </div>
      </div>
    </div>
  </div>

  <div id="episodeModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">íšŒì°¨ ëª©ë¡</div>
        <button class="modal-close" onclick="closeEpisodeModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div id="episodeList" class="episode-list"></div>
      </div>
    </div>
  </div>

  <div id="viewerOverlay" class="viewer-overlay">
    <div class="viewer-content" id="viewerContent" onclick="handleViewerClick(event)">
      <div class="nav-zone nav-prev"></div>
      <div class="nav-zone nav-next"></div>
      <div id="viewerImageContainer" class="viewer-image-container"></div>
      <div id="viewerScrollContainer" class="viewer-scroll-container" style="display: none"></div>
      <div id="pageCounter" class="page-counter">- / -</div>
    </div>

    <div id="viewerControls" class="viewer-controls">
      <div class="viewer-header">
        <span class="viewer-title" id="viewerTitle">Viewer</span>
        <button class="btn-icon close-btn" onclick="closeViewer()">Ã—</button>
      </div>

      <div class="viewer-footer">
        <div class="footer-row main-row">
          <button class="btn-icon" onclick="openEpisodeListFromViewer()" title="ëª©ì°¨">ğŸ“‘</button>
          <div class="slider-container">
            <span id="sliderCurrent" class="slider-label">1</span>
            <input type="range" id="pageSlider" min="1" max="100" value="1" step="1" oninput="onSliderInput(this.value)" onchange="onSliderChange(this.value)" />
            <span id="sliderTotal" class="slider-label">100</span>
          </div>
          <div class="nav-buttons">
            <button class="btn-icon" onclick="navigateViewer(-1)">â—€</button>
            <button class="btn-icon" onclick="navigateViewer(1)">â–¶</button>
          </div>
        </div>

        <div class="footer-row settings-row">
          <button id="btnTwoPage" class="btn-toggle image-only" onclick="toggleViewMode()">2ìª½ ë³´ê¸°</button>
          <button id="btnCover" class="btn-toggle image-only" onclick="toggleCoverMode()">í‘œì§€ ë¨¼ì €</button>
          <button id="btnScroll" class="btn-toggle" onclick="toggleScrollMode()">ìŠ¤í¬ë¡¤ ë³´ê¸°</button>
          <button id="btnRtl" class="btn-toggle image-only" onclick="toggleRtlMode()">ì¼ë³¸ì–´(ìš°ì¢Œ)</button>
          <button class="btn-toggle epub-only" onclick="changeFontSize(-2)">ê¸€ì -</button>
          <button class="btn-toggle epub-only" onclick="changeFontSize(2)">ê¸€ì +</button>
          <div class="divider"></div>
          <button id="btnPreload" class="btn-toggle" onclick="togglePreloadMode()">ë¯¸ë¦¬ ë“±</button>
        </div>
      </div>
    </div>
  </div>

  <div id="pageLoader" class="loader-overlay">
    <div class="spinner"></div>
    <div class="loader-text">Loading...</div>
  </div>

  <script>
    (function() {
      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
      updateThemeIcons(savedTheme);
    })();

    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeIcons(newTheme);
    }

    function updateThemeIcons(theme) {
      const icon = theme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
      const indicator = document.getElementById('themeIndicator');
      const headerIcon = document.getElementById('headerThemeIcon');
      if (indicator) indicator.textContent = icon;
      if (headerIcon) headerIcon.textContent = icon;
    }

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      const toggle = document.querySelector('.sidebar-toggle');
      sidebar.classList.toggle('open');
      overlay.classList.toggle('show');
      toggle.classList.toggle('hidden');
    }

    function toggleSettingsAccordion() {
      const content = document.getElementById('settingsContent');
      const icon = document.getElementById('settingsIcon');
      if (!content || !icon) return;
      const isOpen = content.classList.contains('open');
      if (isOpen) {
        content.classList.remove('open');
        content.style.maxHeight = '0';
        icon.textContent = 'â–¼';
      } else {
        content.classList.add('open');
        content.style.maxHeight = content.scrollHeight + 'px';
        icon.textContent = 'â–²';
      }
    }

    let adultFilterEnabled = false;
    function toggleAdultFilter() {
      adultFilterEnabled = !adultFilterEnabled;
      const toggle = document.getElementById('adultToggle');
      if (toggle) toggle.classList.toggle('active', adultFilterEnabled);
    }

    function showCalendar() {
      const grid = document.getElementById('grid');
      const calPage = document.getElementById('calendarPage');
      if (grid) grid.style.display = 'none';
      if (calPage) calPage.style.display = 'block';
      toggleSidebar();
    }

    function showFavorites() {
      toggleSidebar();
      showToast('ğŸ“Œ ì¦ê²¨ì°¾ê¸° ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘...');
    }

    function showTags() {
      const modal = document.getElementById('tagsModal');
      if (modal) modal.style.display = 'flex';
      toggleSidebar();
    }

    function closeTagsModal() {
      const modal = document.getElementById('tagsModal');
      if (modal) modal.style.display = 'none';
    }

    function showBackupRestore() {
      showToast('ğŸ’¾ ë°±ì—…/ë³µì› ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘...');
    }

    function createTag() {
      showToast('ğŸ·ï¸ íƒœê·¸ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘...');
    }

    function prevMonth() {}
    function nextMonth() {}
    function showAddRecordModal() {}
  </script>

  <script type="module" src="js/include.js?v=3.3.4"></script>
</body>
</html>
